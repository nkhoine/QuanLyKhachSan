--------------------------------------------------------
-- FILE: Nhom5_qlks_FIXED.sql
-- KET NOI: QUANLYKS / 123456
--------------------------------------------------------

-- 1. LOAIPHONG
CREATE TABLE LOAIPHONG (
    MALOAIPHONG VARCHAR2(10) PRIMARY KEY,
    TENLOAI NVARCHAR2(50) NOT NULL,
    GIA_COBAN NUMBER(10, 2) NOT NULL
);

-- 2. PHONG
CREATE TABLE PHONG (
    MAPHONG VARCHAR2(10) PRIMARY KEY,
    MALOAIPHONG VARCHAR2(10) REFERENCES LOAIPHONG(MALOAIPHONG),
    SOPHONG VARCHAR2(10) NOT NULL,
    TINHTRANG NVARCHAR2(20) DEFAULT 'Tr?ng'
);

-- 3. NHANVIEN
CREATE TABLE NHANVIEN (
    MANV VARCHAR2(10) PRIMARY KEY,
    HOTEN NVARCHAR2(100) NOT NULL,
    EMAIL VARCHAR2(100),
    SDT VARCHAR2(15),
    TENDANGNHAP VARCHAR2(50) UNIQUE NOT NULL, 
    MATKHAU VARCHAR2(256) NOT NULL, 
    CHUCVU NVARCHAR2(50), 
    LUONG_GOC NUMBER(15, 2),
    LUONG_ENC RAW(2000),      
    PUBLIC_KEY VARCHAR2(4000),
    FAILED_LOGIN NUMBER DEFAULT 0,
    LOCK_UNTIL DATE
);

-- 4. KHACHHANG
CREATE TABLE KHACHHANG (
    MAKH VARCHAR2(10) PRIMARY KEY,
    HOTEN NVARCHAR2(100) NOT NULL,
    SDT VARCHAR2(15),
    DIACHI NVARCHAR2(200),
    CCCD_GOC VARCHAR2(20),
    CCCD_ENC RAW(2000)
);

-- 5. DATPHONG
CREATE TABLE DATPHONG (
    MADP VARCHAR2(10) PRIMARY KEY,
    MAKH VARCHAR2(10) REFERENCES KHACHHANG(MAKH),
    MAPHONG VARCHAR2(10) REFERENCES PHONG(MAPHONG),
    MANV VARCHAR2(10) REFERENCES NHANVIEN(MANV),
    NGAYDAT DATE DEFAULT SYSDATE,
    NGAYDEN DATE,
    NGAYDI DATE,
    TRANGTHAI NVARCHAR2(50)
);

-- 6. DICHVU
CREATE TABLE DICHVU (
    MADV VARCHAR2(10) PRIMARY KEY,
    TENDV NVARCHAR2(100),
    DONGIA NUMBER(10, 2)
);

-- 7. HOADON
CREATE TABLE HOADON (
    MAHD VARCHAR2(10) PRIMARY KEY,
    MADP VARCHAR2(10) REFERENCES DATPHONG(MADP),
    MANV VARCHAR2(10) REFERENCES NHANVIEN(MANV),
    NGAYLAP DATE DEFAULT SYSDATE,
    TONGTIEN NUMBER(15, 2),
    CHUKY_SO RAW(2000),
    GHI_CHU_BAOMAT BLOB 
);

-- 8. CHITIET_DICHVU
CREATE TABLE CHITIET_DICHVU (
    MAHD VARCHAR2(10) REFERENCES HOADON(MAHD),
    MADV VARCHAR2(10) REFERENCES DICHVU(MADV),
    SOLUONG NUMBER DEFAULT 1,
    THANHTIEN NUMBER(15, 2),
    PRIMARY KEY (MAHD, MADV)
);

-- 9. LOG_AUDIT
CREATE TABLE LOG_AUDIT
(
    ID_LOG      NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    ACTION_TIME TIMESTAMP,
    ACTION_TYPE VARCHAR2(10),
    TABLE_NAME  VARCHAR2(30),
    OLD_DATA    VARCHAR2(2000),
    NEW_DATA    VARCHAR2(2000),
    MANV        VARCHAR2(10),
    HOTEN       NVARCHAR2(100)
);